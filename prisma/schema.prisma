
generator client {
    provider = "prisma-client-js"
    output = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
}

// Declering ENUMS

enum UserStatus {
    PENDING
    ACTIVE
    SUSPENDED
}

enum Role {
    SUPER_ADMIN
    BUSINESS_ADMIN
    STAFF
    CUSTOMER
}

enum BusinessStatus {
    PENDING
    APPROVED
    REJECTED
    SUSPENDED
}

enum QueueStatus {
    OPEN
    PAUSED // Staff is on break. Tokens still generate, but serving is temporarily stopped.
    LOCKED // stop generating new tokens, already tokens have reached to maximum number for serving
    CLOSED //End of the day , no one can generate tokens and no one is serving
}

enum TokenState {
    WAITING
    CALLED
    SERVING
    COMPLETED
    SKIPPED
    PRIORITY
    CANCELLED
    EXPIRED
}

// MODELS

model Token {
    id Int @default(autoincrement()) @id
    queueId Int
    businessId  Int
    userId Int 
    sequenceNumber Int
    state TokenState @default(WAITING)
    calledAt DateTime? @db.Timestamptz()
    servedAt DateTime? @db.Timestamptz()
    completedAt DateTime? @db.Timestamptz()
    
    createdAt DateTime @default(now()) @db.Timestamptz()
    updatedAt DateTime @updatedAt @db.Timestamptz()

    queue Queue @relation(fields: [queueId],references: [id],onDelete: Cascade,onUpdate: Cascade)
    business Business @relation(fields: [businessId],references: [id],onDelete: Cascade, onUpdate: Cascade)
    @@unique([queueId, sequenceNumber])
    user User @relation(fields: [userId],references: [id],onDelete: Cascade,onUpdate:Cascade)
    @@map("tokens")
}